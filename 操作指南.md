# Clavisnova 钢琴捐赠分享平台 - 操作指南

## 🎹 项目概述

Clavisnova 是一个志愿者主导的钢琴捐赠与分享平台，帮助学校和社区获取钢琴资源。该平台连接捐赠者和学校，让每一架钢琴都能找到合适的归宿。

## 🚀 项目架构

- **前端**: HTML/CSS/JavaScript，部署在 Cloudflare Pages
- **后端**: Python Flask API，部署在 Render
- **数据库**: PostgreSQL，托管在 Supabase
- **域名**: 通过 Cloudflare Pages 提供

## 📋 主要功能

### 面向用户功能
- **钢琴捐赠登记**: 个人或机构可以轻松登记捐赠钢琴
- **学校需求提交**: 学校可以提交钢琴需求信息
- **联系表单**: 用户可以通过联系表单与我们沟通

### 管理员功能
- **数据管理**: 查看和管理所有捐赠和需求数据
- **数据导出**: 支持 Excel 和 CSV 格式导出
- **统计信息**: 查看平台使用统计
- **数据删除**: 删除不需要的数据记录
- **邮件通知**: 新表单提交时自动发送邮件提醒

## 🔧 日常操作指南

### 1. 访问平台

**用户访问地址**: `https://your-frontend-domain.pages.dev`
**管理员后台**: `https://your-frontend-domain.pages.dev/admin.html`

### 2. 管理员登录

管理员后台目前没有密码保护，直接访问 `/admin.html` 即可进入管理界面。

> ⚠️ **安全建议**: 建议添加密码保护或IP限制来保护管理员功能。

### 3. 数据管理操作

#### 查看捐赠数据
1. 进入管理员后台
2. 点击 "Piano Registrations" 标签页
3. 查看捐赠钢琴列表，包括：
   - 制造商、型号、序列号
   - 年份、类型、尺寸
   - 地点、联系方式等信息

#### 查看需求数据
1. 点击 "Requirements" 标签页
2. 查看学校需求列表，包括：
   - 学校名称、现有钢琴情况
   - 教师信息、背景介绍
   - 承诺和期望等

#### 查看联系信息
1. 点击 "Contacts" 标签页
2. 查看用户联系表单提交的信息

### 4. 数据导出操作

#### 导出捐赠数据
1. 在 "Piano Registrations" 标签页
2. 点击 "Export to Excel" 按钮
3. 浏览器会自动下载 Excel 文件

#### 导出需求数据
1. 在 "Requirements" 标签页
2. 点击 "Export to Excel" 按钮
3. 浏览器会自动下载 Excel 文件

> 📝 **注意**: 如果服务器没有安装 Excel 库，会自动降级为 CSV 格式导出。

### 5. 数据删除操作

#### 删除捐赠记录
1. 在捐赠列表中找到要删除的记录
2. 点击该行中的 "Delete" 按钮
3. 确认删除操作

#### 删除需求记录
1. 在需求列表中找到要删除的记录
2. 点击该行中的 "Delete" 按钮
3. 确认删除操作

#### 删除联系记录
1. 在联系列表中找到要删除的记录
2. 点击该行中的 "Delete" 按钮
3. 确认删除操作

### 6. 搜索功能

在各个数据标签页中，可以使用搜索框来筛选数据：
- **捐赠数据**: 搜索制造商、型号、序列号或地点
- **需求数据**: 搜索学校名称、教师姓名或其他文本字段

## 📧 邮件通知配置

平台支持在新表单提交时自动发送邮件提醒。

### ⚠️ 重要提醒
**Cloudflare Pages 不提供邮箱服务**。您需要准备自己的邮箱账户作为发件邮箱。

### 配置步骤
1. **准备发件邮箱**（Gmail、Outlook等现有邮箱）
2. **设置邮件环境变量**（在 Render 控制台）
3. **指定接收邮箱**（您要接收通知的邮箱）

详细配置请参考：[邮件通知配置指南](./邮件通知配置指南.md)

### 邮件通知类型
- **捐赠登记通知**: 包含钢琴详细信息
- **需求提交通知**: 包含学校和教师信息
- **联系表单通知**: 包含用户咨询内容

## 📊 统计信息查看

在管理员后台首页可以查看：
- 总捐赠数量
- 总需求数量
- 总提交数

## 🔍 系统监控

### 健康检查
访问 `https://your-backend-url.onrender.com/api/health` 可以检查系统状态：
- 数据库连接状态
- 系统版本信息
- 运行时间等

### 日志查看
后端日志可以通过以下方式查看：
1. 登录 Render 控制台
2. 进入应用详情页
3. 查看 "Logs" 标签页

## 🛠️ 维护操作

### 定期备份

#### 数据库备份
1. 登录 Supabase 控制台
2. 进入项目设置
3. 使用 "Database" -> "Backups" 功能
4. 创建手动备份或设置自动备份

#### 代码备份
代码已经托管在 GitHub，自动备份。

### 性能监控

#### Render 监控
- 应用状态和运行时间
- 资源使用情况（CPU、内存）
- 请求日志和错误日志

#### Supabase 监控
- 数据库性能指标
- 查询统计
- 存储使用情况

## ⚠️ 故障排除

### 常见问题

#### 1. 前端无法访问
- 检查 Cloudflare Pages 部署状态
- 确认域名解析正确
- 检查 Cloudflare 配置

#### 2. API 调用失败
- 检查 Render 应用状态
- 查看后端日志中的错误信息
- 确认环境变量配置正确

#### 3. 数据库连接问题
- 检查 Supabase 项目状态
- 确认数据库 URL 和密码正确
- 检查网络连接权限

#### 4. 数据导出失败
- 检查服务器是否有足够内存
- 确认 Excel 库是否正确安装
- 查看后端日志

### 紧急联系

如果遇到严重问题：
1. 首先检查系统日志
2. 联系技术支持团队
3. 如有必要，可以回滚到上一个稳定版本

## 📈 数据管理最佳实践

### 数据清理
- 定期删除过期或无效的数据
- 清理测试数据
- 维护数据质量

### 隐私保护
- 注意用户数据的隐私保护
- 遵守相关数据保护法规
- 定期审查数据保留政策

### 备份策略
- 每周自动备份数据库
- 每月创建完整备份
- 重要变更前手动备份

## 🔄 系统更新

### 代码更新
1. 在 GitHub 上提交代码变更
2. Render 会自动检测并重新部署
3. Cloudflare Pages 也会自动更新

### 依赖更新
定期检查并更新：
- Python 包版本
- 系统依赖
- 安全补丁

## 📞 支持与反馈

### 技术支持
- 检查本文档的故障排除部分
- 查看 GitHub Issues
- 联系开发团队

### 用户反馈
- 通过平台的联系表单收集用户反馈
- 定期审查反馈并改进系统

---

*最后更新: 2025年1月*
*维护者: Clavisnova 志愿者团队*
*联系邮箱: info@pianoforschools.org*
