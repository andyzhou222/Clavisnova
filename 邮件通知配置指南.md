# Clavisnova 邮件通知配置指南

## 🎯 功能概述

当有人提交表单时，系统会自动向指定的邮箱发送通知邮件，包括：
- **钢琴捐赠登记**：新的捐赠信息
- **学校需求提交**：新的需求信息
- **联系表单**：用户咨询信息

## 📧 邮件配置步骤

### 0. 关于发件邮箱

**❌ Cloudflare Pages 不提供邮箱服务**

Cloudflare Pages 是一个静态网站托管平台，**不提供邮件发送服务**。您需要使用现有的邮箱账户作为发件邮箱。

**✅ 需要准备什么：**
- 一个现有的邮箱账户（Gmail、Outlook、QQ邮箱等）
- 该邮箱账户的SMTP发送权限
- （推荐）为该邮箱开启应用密码或授权码

**💡 推荐方案：**
- 使用您的个人Gmail账户（需要开启2步验证并生成应用密码）
- 或使用专门的工作邮箱
- 或注册一个新的邮箱专门用于系统通知

### 1. 选择邮件服务提供商

推荐使用以下邮件服务：
- **Gmail** (最常用，配置简单)
- **Outlook/Hotmail** (微软服务)
- **企业邮箱** (如QQ邮箱、163邮箱等)

### 2. Gmail 配置步骤

#### 创建应用密码 (推荐方式，更安全)
1. 访问 [Google 账户设置](https://myaccount.google.com/)
2. 点击左侧菜单的"安全"
3. 在"登录 Google"部分点击"2 步验证"
4. 启用 2 步验证
5. 返回安全页面，点击"应用密码"
6. 选择"其他(自定义名称)"，输入"Clavisnova"
7. 生成16位应用密码，复制保存

#### 配置环境变量
在 Render 或本地 `.env` 文件中设置：

```bash
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=true
MAIL_USE_SSL=false
MAIL_USERNAME=your-gmail@gmail.com
MAIL_PASSWORD=your-16-character-app-password
MAIL_DEFAULT_SENDER=your-gmail@gmail.com
NOTIFICATION_EMAIL=admin@pianoforschools.org
```

### 3. Outlook/Hotmail 配置

```bash
MAIL_SERVER=smtp-mail.outlook.com
MAIL_PORT=587
MAIL_USE_TLS=true
MAIL_USE_SSL=false
MAIL_USERNAME=your-email@outlook.com
MAIL_PASSWORD=your-password
MAIL_DEFAULT_SENDER=your-email@outlook.com
NOTIFICATION_EMAIL=admin@pianoforschools.org
```

### 4. QQ邮箱配置

```bash
MAIL_SERVER=smtp.qq.com
MAIL_PORT=587
MAIL_USE_TLS=true
MAIL_USE_SSL=false
MAIL_USERNAME=your-qq@qq.com
MAIL_PASSWORD=your-authorization-code
MAIL_DEFAULT_SENDER=your-qq@qq.com
NOTIFICATION_EMAIL=admin@pianoforschools.org
```

> **注意**: QQ邮箱需要先开启SMTP服务并获取授权码

### 5. 163邮箱配置

#### 开启SMTP服务并获取授权码
1. 登录 [163邮箱网页版](https://mail.163.com)
2. 点击右上角头像 → "设置"
3. 点击左侧菜单"客户端授权密码"
4. 开启"开启客户端SMTP服务"
5. 生成授权码（保存好这个授权码）

#### 配置环境变量
```bash
MAIL_SERVER=smtp.163.com
MAIL_PORT=465
MAIL_USE_TLS=false
MAIL_USE_SSL=true
MAIL_USERNAME=your-163@163.com
MAIL_PASSWORD=your-authorization-code  # 使用上面生成的授权码
MAIL_DEFAULT_SENDER=your-163@163.com
NOTIFICATION_EMAIL=admin@pianoforschools.org
```

## 🚀 部署配置

### 在 Render 上配置环境变量

1. 登录 [Render 控制台](https://render.com)
2. 选择您的 Clavisnova 应用
3. 点击 "Environment"
4. 添加以下环境变量：

| 变量名 | 值示例 | 说明 |
|--------|--------|------|
| `MAIL_SERVER` | `smtp.gmail.com` | SMTP服务器地址 |
| `MAIL_PORT` | `587` | SMTP服务器端口 |
| `MAIL_USE_TLS` | `true` | 是否使用TLS加密 |
| `MAIL_USE_SSL` | `false` | 是否使用SSL加密 |
| `MAIL_USERNAME` | `your-email@gmail.com` | 发件邮箱 |
| `MAIL_PASSWORD` | `your-app-password` | 邮箱密码或应用密码 |
| `MAIL_DEFAULT_SENDER` | `your-email@gmail.com` | 默认发件人 |
| `NOTIFICATION_EMAIL` | `admin@pianoforschools.org` | 通知接收邮箱 |

5. 保存更改
6. Render 会自动重新部署应用

## 📧 邮件内容示例

### 捐赠登记通知
```
主题: 🎹 新的钢琴捐赠登记 - Clavisnova

亲爱的管理员，

您收到了一份新的钢琴捐赠登记：

捐赠信息：
- 制造商: Yamaha
- 型号: U3
- 序列号: ABC123
- 年份: 2010
- 类型:  upright
- 地点: New York, NY
- 联系方式: john@example.com

请及时查看管理员后台处理此捐赠请求。

此邮件由 Clavisnova 系统自动发送。
```

### 需求提交通知
```
主题: 🎹 新的学校需求提交 - Clavisnova

亲爱的管理员，

您收到了一份新的学校钢琴需求提交：

学校信息：
- 学校名称: Lincoln Elementary School
- 现有钢琴: 1 old upright piano
- 偏好类型: Grand piano
- 教师姓名: Ms. Johnson

请及时查看管理员后台处理此需求。

此邮件由 Clavisnova 系统自动发送。
```

### 联系表单通知
```
主题: 🎹 新的联系表单提交 - Clavisnova

亲爱的管理员，

您收到了一份新的联系表单提交：

联系信息：
- 姓名: John Doe
- 邮箱: john@example.com
- 消息内容: 我想了解如何捐赠钢琴...

请及时回复用户咨询。

此邮件由 Clavisnova 系统自动发送。
```

## 🔧 测试邮件功能

### 本地测试
1. 在本地 `.env` 文件中配置邮件变量
2. 运行后端服务器
3. 提交一个测试表单
4. 检查指定邮箱是否收到通知

### 生产环境测试
1. 部署更新后的代码到 Render
2. 在前端提交测试表单
3. 检查通知邮箱是否收到邮件

## ⚠️ 注意事项

### 安全提醒
- **不要将真实密码提交到代码仓库**
- **使用应用密码而不是账户密码**
- **定期更换应用密码**
- **保护好 `.env` 文件**

### 邮件服务限制
- **Gmail**: 每日500封邮件限制
- **Outlook**: 每日300封邮件限制
- **企业邮箱**: 根据服务商而定

### 故障排除
1. **邮件发送失败**: 检查邮箱密码和服务器设置
2. **邮件被拦截**: 检查垃圾邮件文件夹
3. **连接超时**: 确认防火墙和网络设置

## 📞 支持

如果遇到配置问题：
1. 检查 Render 日志中的错误信息
2. 验证邮箱服务商的设置
3. 联系技术支持

---

*最后更新: 2025年1月*
